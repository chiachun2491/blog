<!doctype html><html lang=zh-tw><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="2020 Fall Infomation Retrieval Homework Report"><title>Query Modeling</title><link rel=canonical href=https://blog.jeffery.tk/p/ir-homework5/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Query Modeling"><meta property="og:description" content="2020 Fall Infomation Retrieval Homework Report"><meta property="og:url" content="https://blog.jeffery.tk/p/ir-homework5/"><meta property="og:site_name" content="Jeffery's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="ntust"><meta property="article:tag" content="information retrieval"><meta property="article:tag" content="homework"><meta property="article:tag" content="report"><meta property="article:tag" content="query modeling"><meta property="article:tag" content="rocchio"><meta property="article:tag" content="smm"><meta property="article:published_time" content="2020-12-17T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-17T00:00:00+00:00"><meta name=twitter:title content="Query Modeling"><meta name=twitter:description content="2020 Fall Infomation Retrieval Homework Report"><link rel="shortcut icon" href=/favicon.png></head><body class="article-page has-toc"><script>(function(){const colorSchemeKey='StackColorScheme';if(!localStorage.getItem(colorSchemeKey)){localStorage.setItem(colorSchemeKey,"auto");}})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.documentElement.dataset.scheme='dark';}else{document.documentElement.dataset.scheme='light';}})();</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://blog.jeffery.tk/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/information-retrieval/>Information Retrieval</a>
<a href=/categories/report/>Report</a></header><h2 class=article-title><a href=/p/ir-homework5/>Query Modeling</a></h2><h3 class=article-subtitle>2020 Fall Infomation Retrieval Homework Report</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Dec 17, 2020</time></footer></div></header><section class=article-content><h2 id=kaggle-competitions>Kaggle competitions</h2><blockquote><p>2020: Information Retrieval and Applications<br>Homework 5: Query Modeling<br><a href=https://www.kaggle.com/c/2020-information-retrieval-and-applications-hw5>https://www.kaggle.com/c/2020-information-retrieval-and-applications-hw5</a></p></blockquote><h2 id=github-code>Github code</h2><blockquote><p><a href=https://github.com/chiachun2491/NTUST_IR/tree/master/homework5>https://github.com/chiachun2491/NTUST_IR/tree/master/homework5</a></p></blockquote><h2 id=homework-report>Homework report</h2><h3 id=使用的-tool>使用的 tool</h3><p>Python, numpy, pandas, collections.Counter, scipy.sparse, numba.jit, datetime</p><h3 id=資料前處理>資料前處理</h3><ol><li>將 <code>doc_list.txt</code>, <code>query_list.txt</code> 讀檔進來後，之後將每個 doc 和 query 使用 <code>collections.Counter</code> 儲存。</li><li>生成 document 和 query 的 tf-idf</li><li>Lexicon 生成方式：使用 df 範圍（5 ~ 10000）的單字，過濾一些 stop word 和稀少的單字。</li><li>在 <code>c(w,d)</code>, <code>c(w,q)</code> 使用 sublinear_tf，並先計算好 document 和 query 的 unigram language model，也先計算好 background language model。</li></ol><h3 id=作業流程>作業流程</h3><p>使用 vsm 做為第一次檢索的結果去做 rocchio，再將 rocchio 最好的結果作為 smm relevant document，下去做 smm</p><h3 id=rocchio-模型參數調整-homework5_rocchiopy>Rocchio 模型參數調整 (homework5_rocchio.py)</h3><ul><li><p>$TF:\begin{cases}
0 & \text{ if } tf=0 \
1 + log(tf)& \text{ if } tf>=1
\end{cases} \ \ IDF: log(\frac{1 + N}{1 + df_{i}}) + 1$</p></li><li><p>$Rocchio: \vec{q} = \alpha \cdot \vec{q} + \beta \cdot \frac{1}{\left | R_{q} \right |} \cdot \left ( \sum_{d_{j}\in R_{q}} \vec{d_{j}} \right ) - \gamma \cdot \frac{1}{\left | \bar{R_{q}} \right |} \cdot \left ( \sum_{d_{{j}'}\in \bar{R_{q}}} \vec{d_{{j}'}} \right )$</p></li><li><p>最終使用參數（Kaggle Public Score: 0.54248）：</p><ul><li><code>alpha</code> = <code>1</code> / <code>beta</code> = <code>0.5</code> / <code>gamma</code> = <code>0.15</code> / <code>rele_doc</code> = <code>5</code> / <code>nrele_doc</code> = <code>1</code> / <code>epoch</code> = <code>5</code></li></ul></li></ul><h3 id=simple-mixture-model-參數調整-homework5_smmpy>Simple Mixture Model 參數調整 (homework5_smm.py)</h3><ul><li><p>$KL(q||d_{j}) \propto - \sum_{w\in V} P(w|q)logP(w|d_{j})$</p></li><li><p>$P(w|q) = \alpha \times P_{ULM}(w|q) + \beta \times P_{SMM}(w|q) + (1 - \alpha -\beta ) \times P_{BG}(w)$</p></li><li><p>$P(w|d_{j}) = \gamma \times P_{ULM}(w|d_{j}) + (1 - \gamma ) \times P_{BG}(w)
$</p></li><li><p>最終使用參數（Kaggle Public Score: 0.59390）：</p><ul><li><code>alpha</code> = <code>0.1</code> / <code>beta</code> = <code>0.85</code> / <code>gamma</code> = <code>0.2</code> / <code>rele_doc</code> = <code>5</code> / <code>epoch</code> = <code>50</code> / <code>smm_alpha</code> = <code>0.6</code></li></ul></li></ul><h3 id=各種-model-的分數表現>各種 model 的分數表現</h3><table><thead><tr><th>Model Name</th><th>Parameter</th><th style=text-align:right>Kaggle Public MAP@5000</th><th>Note</th></tr></thead><tbody><tr><td>VSM (TF-IDF)</td><td>smooth_idf, sublinear_tf</td><td style=text-align:right>0.41864</td><td>取全部的單字</td></tr><tr><td>VSM (TF-IDF)</td><td>smooth_idf, sublinear_tf</td><td style=text-align:right>0.42399</td><td>只取 query 出現過的單字</td></tr><tr><td>BM25</td><td>K1=0.8, K3=1000, b=0.7</td><td style=text-align:right>0.48936</td><td></td></tr><tr><td>Rocchio</td><td>a=1, b=0.5, g=0.15, reledoc=5, nreledoc=1, epoch=5</td><td style=text-align:right>0.52744</td><td>取全部的單字</td></tr><tr><td>Rocchio</td><td>a=1, b=0.5, g=0.15, reledoc=5, nreledoc=1, epoch=5</td><td style=text-align:right>0.54248</td><td>取 df >= 5 的單字</td></tr><tr><td>SMM</td><td>smm_a=0.3, reledoc=5, epoch=50, a=0.15, b=0.8, g=0.3</td><td style=text-align:right>0.57964</td><td>取 df >= 5 的單字</td></tr><tr><td>SMM</td><td>smm_a=0.6, reledoc=5, epoch=50, a=0.1, b=0.85, g=0.2</td><td style=text-align:right><strong>0.59390</strong></td><td>取 10000 &lt;= df >= 5 的單字</td></tr></tbody></table><h3 id=模型運作原理>模型運作原理</h3><p>query model 主要是要解決 query 的資訊量過少的問題，像 rocchio 就是將 query 的向量加上了相關的文件向量也去除了一些些不相關文章向量，讓 query vector 能夠涵蓋更多資訊，SMM 則是透過 training P_smm 和 P_bg 讓更多特定的單字（在 background model 中沒有辦法被找到的單字）能夠在 P_smm 中的機率提高，提升 query model 的判別力。</p><h3 id=個人心得>個人心得</h3><p>　　這次作業一開始寫的時候原本以為會很簡單，想說直接挑戰實作 SMM，結果馬上被單字量嚇到，一開始也做不出來，所以就轉戰 rochhio，但是發現用第一次作業的 VSM 都沒有過 baseline，後來想說先用 sklearn 的 tfidfvectorizer 跑跑看，發現有 sublinear_tf 這個參數可以調整用來縮減 document 長度的問題，發現可以過 baseline，就趕快把公式套上去，這次作業也重做的第一次作業的 VSM，上次作業知道 sparce matrix 後，發現在 VSM 實作效率超級高，後來嘗試去掉一些出現次數較少的單字也有提升一些分數，沒嘗試太多組參數就開始做 SMM，因為這次 VSM 有重做的關係，在前處理建 unigram 和 background model 的時候都比上次 PLSA 的效率快多啦，後面就開始調整 SMM 的參數，然後到了一個瓶頸後又把目前最高分的結果當作 relevant feedback，的確也有再進步，但後面要再用同一個方法的時候就往下掉了一些，調參數的過程中也好擔心 private 的成績會掉超多的 QQ。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/ntust/>ntust</a>
<a href=/tags/information-retrieval/>information retrieval</a>
<a href=/tags/homework/>homework</a>
<a href=/tags/report/>report</a>
<a href=/tags/query-modeling/>query modeling</a>
<a href=/tags/rocchio/>rocchio</a>
<a href=/tags/smm/>smm</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true}]});})</script></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/p/ir-homework4/><div class=article-image><img src=/p/ir-homework4/qITG12G.5671d03356598a720234f4b848c1d20b_hu1dffc869e1d64a4036e5075742de8ba2_29927_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key=ir-homework4 data-hash="md5-VnHQM1ZZinICNPS4SMHSCw=="></div><div class=article-details><h2 class=article-title>PLSA</h2></div></a></article><article><a href=/p/ir-homework2/><div class=article-details><h2 class=article-title>Best Match Model 25 (BM25)</h2></div></a></article><article><a href=/p/ir-homework1/><div class=article-details><h2 class=article-title>Vector Space Model</h2></div></a></article><article class=has-image><a href=/p/singly-connected-problem/><div class=article-image><img src=/p/singly-connected-problem/vIQLtsy.dc8749621dc52174a753b84b0e1ba5a1_huc152c653de18f942c8476d94e8e99140_70856_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-3IdJYh3FIXSnU7hLDhuloQ=="></div><div class=article-details><h2 class=article-title>Singly Connected Problem</h2></div></a></article><article class=has-image><a href=/p/edge-plate-detection/><div class=article-image><img src=/p/edge-plate-detection/BNgrLe5.79bf412e098ed48782d69c8f96f25eab_huf738ae938586e2523874cb2afd528823_128500_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key=edge-plate-detection data-hash="md5-eb9BLgmO1IeC1pyPlvJeqw=="></div><div class=article-details><h2 class=article-title>利用車牌辨識以檢測違規車牌</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=chiachun2491/blog issue-term=pathname label=comments crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(theme){let utterances=document.querySelector('.utterances iframe');if(utterances){utterances.contentWindow.postMessage({type:'set-theme',theme:`github-${theme}`},'https://utteranc.es');}}
addEventListener('message',event=>{if(event.origin!=='https://utteranc.es')return;setUtterancesTheme(document.documentElement.dataset.scheme)});window.addEventListener('onColorSchemeChange',(e)=>{setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2019 -
2021 Jeffery's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#kaggle-competitions>Kaggle competitions</a></li><li><a href=#github-code>Github code</a></li><li><a href=#homework-report>Homework report</a><ol><li><a href=#使用的-tool>使用的 tool</a></li><li><a href=#資料前處理>資料前處理</a></li><li><a href=#作業流程>作業流程</a></li><li><a href=#rocchio-模型參數調整-homework5_rocchiopy>Rocchio 模型參數調整 (homework5_rocchio.py)</a></li><li><a href=#simple-mixture-model-參數調整-homework5_smmpy>Simple Mixture Model 參數調整 (homework5_smm.py)</a></li><li><a href=#各種-model-的分數表現>各種 model 的分數表現</a></li><li><a href=#模型運作原理>模型運作原理</a></li><li><a href=#個人心得>個人心得</a></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>